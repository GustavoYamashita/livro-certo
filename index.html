{% extends 'galeria/base.html' %}

{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block title %}Início{% endblock %}

{% block content %}
<div class="main-cards">
    <a href="{% url 'livro-tombo' %}">
        <div id="livros-card" class="cards">
            <div class="card-info">
                <h2>{{ total_livros }}</h2>
                <p>Livros</p>
            </div>
            <div class="card-icon">
                <svg width="80" height="80" viewBox="0 0 97 97" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24.25 88.9167C22.0271 88.9167 20.1242 88.1252 18.5412 86.5422C16.9582 84.9592 16.1667 83.0562 16.1667 80.8333V16.1667C16.1667 13.9437 16.9582 12.0408 18.5412 10.4578C20.1242 8.87482 22.0271 8.08333 24.25 8.08333H72.75C74.9729 8.08333 76.8759 8.87482 78.4589 10.4578C80.0419 12.0408 80.8334 13.9437 80.8334 16.1667V80.8333C80.8334 83.0562 80.0419 84.9592 78.4589 86.5422C76.8759 88.1252 74.9729 88.9167 72.75 88.9167H24.25ZM24.25 80.8333H72.75V16.1667H64.6667V40.9219C64.6667 41.7302 64.3299 42.3196 63.6563 42.6901C62.9827 43.0606 62.309 43.0437 61.6354 42.6396L56.6844 39.6083C56.0108 39.2042 55.3203 39.0021 54.613 39.0021C53.9057 39.0021 53.2153 39.2042 52.5417 39.6083L47.5906 42.6396C46.917 43.0437 46.2266 43.0606 45.5193 42.6901C44.812 42.3196 44.4584 41.7302 44.4584 40.9219V16.1667H24.25V80.8333Z" fill="#FFDC5A"/>
                    </svg>
            </div>
        </div>
    </a>

    <a href="{% url 'alunos' %}">
        <div id="alunos-card" class="cards">
            <div class="card-info">
                <h2>{{ total_alunos }}</h2>
                <p>Alunos</p>
            </div>
            <div class="card-icon">
                <svg width="62" height="62" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M36 36C31.05 36 26.8125 34.2375 23.2875 30.7125C19.7625 27.1875 18 22.95 18 18C18 13.05 19.7625 8.8125 23.2875 5.2875C26.8125 1.7625 31.05 0 36 0C40.95 0 45.1875 1.7625 48.7125 5.2875C52.2375 8.8125 54 13.05 54 18C54 22.95 52.2375 27.1875 48.7125 30.7125C45.1875 34.2375 40.95 36 36 36ZM0 63V59.4C0 56.85 0.65625 54.5062 1.96875 52.3687C3.28125 50.2312 5.025 48.6 7.2 47.475C11.85 45.15 16.575 43.4062 21.375 42.2437C26.175 41.0812 31.05 40.5 36 40.5C40.95 40.5 45.825 41.0812 50.625 42.2437C55.425 43.4062 60.15 45.15 64.8 47.475C66.975 48.6 68.7188 50.2312 70.0312 52.3687C71.3438 54.5062 72 56.85 72 59.4V63C72 65.475 71.1187 67.5938 69.3562 69.3562C67.5938 71.1187 65.475 72 63 72H9C6.525 72 4.40625 71.1187 2.64375 69.3562C0.88125 67.5938 0 65.475 0 63ZM9 63H63V59.4C63 58.575 62.7937 57.825 62.3812 57.15C61.9688 56.475 61.425 55.95 60.75 55.575C56.7 53.55 52.6125 52.0312 48.4875 51.0187C44.3625 50.0062 40.2 49.5 36 49.5C31.8 49.5 27.6375 50.0062 23.5125 51.0187C19.3875 52.0312 15.3 53.55 11.25 55.575C10.575 55.95 10.0312 56.475 9.61875 57.15C9.20625 57.825 9 58.575 9 59.4V63ZM36 27C38.475 27 40.5938 26.1187 42.3563 24.3562C44.1188 22.5937 45 20.475 45 18C45 15.525 44.1188 13.4062 42.3563 11.6437C40.5938 9.88125 38.475 9 36 9C33.525 9 31.4062 9.88125 29.6437 11.6437C27.8812 13.4062 27 15.525 27 18C27 20.475 27.8812 22.5937 29.6437 24.3562C31.4062 26.1187 33.525 27 36 27Z" fill="#FFDC5A"/>
                    </svg>
            </div>
        </div>
    </a>

    <a href="{% url 'biblioteca' %}">
        <div id="emprestimos-card" class="cards">
            <div class="card-info">
                <h2>{{ total_emprestimos }}</h2>
                <p>Empréstimos</p>
            </div>
            <div class="card-icon">
                <svg width="78" height="78" viewBox="0 0 98 98" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M52.7771 33.5854L73.0917 13.3729C73.8403 12.6243 74.7761 12.233 75.899 12.199C77.0219 12.1649 77.9917 12.5562 78.8084 13.3729C79.557 14.1215 79.9313 15.0743 79.9313 16.2312C79.9313 17.3882 79.557 18.341 78.8084 19.0896L55.6355 42.2625C54.8188 43.0792 53.866 43.4875 52.7771 43.4875C51.6882 43.4875 50.7355 43.0792 49.9188 42.2625L38.2813 30.625C37.4646 29.8083 37.0733 28.8556 37.1073 27.7667C37.1414 26.6778 37.5667 25.725 38.3834 24.9083C39.2 24.1597 40.1528 23.7684 41.2417 23.7344C42.3306 23.7003 43.2834 24.0917 44.1 24.9083L52.7771 33.5854ZM56.9625 83.3L81.2584 75.7458C80.9181 75.1333 80.4247 74.6059 79.7782 74.1635C79.1316 73.7212 78.4 73.5 77.5834 73.5H56.9625C55.125 73.5 53.6618 73.4319 52.573 73.2958C51.4841 73.1597 50.3612 72.8875 49.2042 72.4792L43.3855 70.5396C42.2966 70.1993 41.5139 69.5187 41.0375 68.4979C40.5612 67.4771 40.4931 66.4222 40.8334 65.3333C41.1737 64.2444 41.8372 63.4448 42.824 62.9344C43.8108 62.424 44.8487 62.3389 45.9375 62.6792L50.225 64.1083C51.382 64.4486 52.6921 64.7208 54.1553 64.925C55.6184 65.1292 57.6091 65.2653 60.1271 65.3333H61.25C61.25 64.5847 61.0289 63.8701 60.5865 63.1896C60.1441 62.509 59.6167 62.0667 59.0042 61.8625L35.1167 53.0833H28.5834V75.5417L56.9625 83.3ZM54.8188 91.2625L28.5834 83.9125C28.0389 85.6819 26.9671 87.1111 25.3677 88.2C23.7684 89.2889 22.1181 89.8333 20.4167 89.8333H12.25C10.0042 89.8333 8.08164 89.0337 6.48233 87.4344C4.88303 85.8351 4.08337 83.9125 4.08337 81.6667V53.0833C4.08337 50.8375 4.88303 48.9149 6.48233 47.3156C8.08164 45.7163 10.0042 44.9167 12.25 44.9167H35.1167C35.5931 44.9167 36.0695 44.9677 36.5459 45.0698C37.0223 45.1719 37.4646 45.291 37.873 45.4271L61.8625 54.3083C64.1084 55.125 65.9289 56.5542 67.324 58.5958C68.7191 60.6375 69.4167 62.8833 69.4167 65.3333H77.5834C80.9862 65.3333 83.8785 66.4562 86.2605 68.7021C88.6424 70.9479 89.8334 73.9083 89.8334 77.5833C89.8334 79.0806 89.4421 80.2545 88.6594 81.1052C87.8768 81.9559 86.6688 82.6535 85.0355 83.1979L59.5146 91.1604C58.766 91.4326 57.9834 91.5687 57.1667 91.5687C56.35 91.5687 55.5674 91.4667 54.8188 91.2625ZM12.25 81.6667H20.4167V53.0833H12.25V81.6667Z" fill="#FFDC5A"/>
                </svg>
            </div>
        </div>
    </a>
</div>

<div class="graficos-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; margin: 20px 0;">
    <div class="grafico-wrapper" style="flex: 1; min-width: 300px; max-width: 400px;">
        <canvas id="grafico1" style="width: 100%; height: 400px;"></canvas>
    </div>
    <div class="grafico-wrapper" style="flex: 1; min-width: 300px; max-width: 400px;">
        <canvas id="grafico2" style="width: 100%; height: 400px;"></canvas>
    </div>
</div>

{{ generos_data|json_script:"generos-data" }}
{{ turmas_data|json_script:"turmas-data" }}

<script>
    const generosData = JSON.parse(document.getElementById('generos-data').textContent);
    const turmasData = JSON.parse(document.getElementById('turmas-data').textContent);
    const ctx = document.getElementById('grafico1');
    const backgroundColors = [
        'rgba(255, 99, 132, 0.7)',
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 206, 86, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 159, 64, 0.7)'
    ];
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: generosData.labels,
            datasets: [{
                label: 'Livros emprestados por gênero',
                data: generosData.data,
                backgroundColor: backgroundColors.slice(0, generosData.labels.length),
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Top 5 Gêneros Mais Emprestados',
                    font: {
                        size: 16
                    }
                },
                legend: {
                    position: 'right'
                }
            }
        }
    });

    const cty = document.getElementById('grafico2');
    
    new Chart(cty, {
        type: 'bar',
        data: {
            labels: turmasData.labels,
            datasets: [{
                label: 'Empréstimos por turma',
                data: turmasData.data,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Top 7 Turmas que Mais Pegam Livros',
                    font: {
                        size: 16
                    }
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Quantidade de Empréstimos'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Turmas'
                    }
                }
            }
        }
    });
</script>
{% endblock %}